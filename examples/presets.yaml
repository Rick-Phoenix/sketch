# yaml-language-server: $schema=../schemas/development.json

# ANCHOR: templates
templates:
  dockerfile: |
    FROM node:23-alpine

    COPY . .
    EXPOSE {{ docker_dev_port | default(value=5173) }}
    CMD ["npm", "run", "dev"]

# Templating presets
templating_presets:
  single_template:
    template: "engine feels good, much {{ condition }} than before... amazing"
    # Local context
    context:
      condition: slower
    output: single.txt

  # Takes an entire directory and renders the templates
  # in the output dir with the same directory structure
  structured_template:
    dir: some/dir/inside/templates_dir
    context: {}

  # Group of individual templates, for granular control
  docker:
    context:
      # Group context
      docker_dev_port: 9530
    templates:
      # Relative paths are joined with the output
      # directory specified via command, (or, by default, to the cwd)
      - output: Dockerfile
        template: dockerfile
        # Local context with higher priority
        context:
          docker_dev_port: 5173

# ANCHOR_END: templates

# ANCHOR: all

# Docker Compose presets
# ANCHOR: docker_compose
docker_compose_presets:
  base:
    volumes:
      my_volume:
        external: true
    networks:
      my_network:
        external: true

  extended:
    extends:
      - base
    services:
      my_service:
        networks:
          - my_network
        volumes:
          - my_volume:/target
    volumes:
      my_other_volume:
        external: true
# ANCHOR_END: docker_compose

# ANCHOR: git
# Gitignore presets
gitignore_presets:
  # Can be a string
  base:
    content: |
      *.env
      dist
  # Or a list of strings
  ts:
    extends:
      # When being merged, the new entries are placed at the top
      - base
    content:
      - "*.tsBuildInfo"
      - node_modules

# Pre-commit presets
pre_commit_presets:
  # Commonly used repo
  base:
    repos:
      - repo: https://github.com/gitleaks/gitleaks
        rev: v8.28.0
        hooks:
          - id: gitleaks

  # Hooks specific to typescript projects
  typescript:
    # Extending the base preset
    extends:
      - base
    repos:
      - repo: local
        hooks:
          - id: oxlint
            name: oxlint
            entry: oxlint
            language: system
            files: '\.svelte$|\.js$|\.ts$'
            types: [file]

# ANCHOR: git_preset
# Git presets
git_presets:
  ts_package:
    # Selecting a preset
    gitignore: ts
    pre_commit: typescript
    # ANCHOR_END: git

    # Templates that will be generated with this preset
    # starting from the new repo's root
    with_templates:
      - template: dockerfile
        output: Dockerfile
    # ANCHOR_END: git_preset

typescript:
  no_default_deps: true

  # `pnpm-workspace.yaml` presets
  pnpm_presets:
    base:
      # All the dirs listed here will be created automatically
      # when new monorepos are created
      packages:
        - packages/*
        - apps/*
      onlyBuiltDependencies:
        - esbuild
      minimumReleaseAge: 1440

  # `package.json` presets
  # ANCHOR: package_json
  package_json_presets:
    # Defining some reusable fields such as some common scripts and dependencies
    frontend:
      description: I am the base preset
      scripts:
        build: vite build
        dev: vite dev
      devDependencies:
        tailwindcss: "*"
        vite: "*"

    svelte_frontend:
      extends: ["frontend"]
      # Adding new fields
      license: MIT
      # Overriding others
      description: I am the frontend preset
      # And merging dependencies
      devDependencies:
        svelte: "*"

    # ANCHOR_END: package_json

  # Tsconfig presets
  # ANCHOR: tsconfig
  ts_config_presets:
    base:
      references:
        - path: /some/path
      include:
        - src
      compilerOptions:
        noEmit: true
        verbatimModuleSyntax: true

    extended:
      # Renamed to avoid conflict with the `extends` field
      extend_presets:
        - base
      # Unlike in real tsconfigs with `extends`, references are merged here,
      # and so are all other collections such as `files` or `include`.
      references:
        - path: /other/path
      include:
        - tests
      compilerOptions:
        # Whereas other fields are overwritten
        noEmit: false

    # ANCHOR_END: tsconfig

  # Oxlint presets
  # ANCHOR: oxlint
  oxlint_presets:
    base:
      ignorePatterns:
        - "**/node_modules/**"

    extended:
      # Renamed to avoid collisions with oxlint's own `extends` field
      extend_presets:
        - base
      ignorePatterns:
        - .cache
  # ANCHOR_END: oxlint

  # Vitest presets
  # ANCHOR: vitest
  vitest_presets:
    base:
      # Where the config file should be generated, starting from
      # the root of the package.
      # It defaults to the value of `tests_dir`
      out_dir: null

      # The directory to use for tests, from the root of the package
      tests_dir: tests

      # The directory, inside `tests_dir`, that contains the setup files for tests.
      # A file named `tests_setup.ts`, containing some basic testing boilerplate,
      # will be generated inside of it.
      setup_dir: setup

      # A list of setup files (the paths will be joined to the `setup_dir`)
      # `tests_setup.ts` will be added automatically.
      setup_files:
        - somefile.ts
        - anotherfile.ts
      environment: jsdom
      silent: passed-only

  # ANCHOR_END: vitest

  # Package presets
  # ANCHOR: package
  package_presets:
    example:
      name: example

      # For every preset, we can either refer to them
      # by their id...
      package_json: svelte_frontend

      # ...or we can inline a preset definition
      oxlint:
        extend_presets:
          - extended
        ignorePatterns:
          - .output

      # We can define one or many tsconfig files
      ts_config:
        # Can be omitted, would default to `tsconfig.json`
        - output: tsconfig.json
          config:
            # Once again creating a new config here with some extras
            extend_presets:
              - extended
            include:
              - scripts

      vitest: base
      # ANCHOR_END: package

      # ANCHOR_END: all
